<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>lib/class/Side.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h2><a href="https://github.com/tonylukasavage/lucid-dream" target="_blank" class="menu-item" id="github-link" >Github</a></h2><h2><a href="https://discord.gg/BHJ964k" target="_blank" class="menu-item" id="github-link" >Discord</a></h2><h3>Classes</h3><ul><li><a href="Apply.html">Apply</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Apply.html#toDict">toDict</a></li></ul></li><li><a href="Decal.html">Decal</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Decal.html#toDict">toDict</a></li></ul></li><li><a href="Effect.html">Effect</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Effect.html#toDict">toDict</a></li></ul></li><li><a href="Entity.html">Entity</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Entity.html#toDict">toDict</a></li></ul></li><li><a href="Filler.html">Filler</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Filler.html#toDict">toDict</a></li></ul></li><li><a href="Lucid.html">Lucid</a></li><li><a href="Map.html">Map</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Map.html#decode">decode</a></li><li data-type='method' style='display: none;'><a href="Map.html#encode">encode</a></li><li data-type='method' style='display: none;'><a href="Map.html#toDict">toDict</a></li></ul></li><li><a href="ObjectTiles.html">ObjectTiles</a><ul class='methods'><li data-type='method' style='display: none;'><a href="ObjectTiles.html#size">size</a></li></ul></li><li><a href="Parallax.html">Parallax</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Parallax.html#toDict">toDict</a></li></ul></li><li><a href="Room.html">Room</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Room.html#toDict">toDict</a></li></ul></li><li><a href="Side.html">Side</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Side.html#decode">decode</a></li><li data-type='method' style='display: none;'><a href="Side.html#encode">encode</a></li></ul></li><li><a href="Spinner.html">Spinner</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Spinner.html#toDict">toDict</a></li></ul></li><li><a href="Style.html">Style</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Style.html#toDict">toDict</a></li></ul></li><li><a href="Tiles.html">Tiles</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Tiles.html#minimizeTilesString">minimizeTilesString</a></li><li data-type='method' style='display: none;'><a href="Tiles.html#size">size</a></li></ul></li><li><a href="Trigger.html">Trigger</a><ul class='methods'><li data-type='method' style='display: none;'><a href="Trigger.html#toDict">toDict</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">lib/class/Side.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>const path = require('path');
const { Map } = require('.');
const { children, dictAsEncodedData, loadDataAsDict } = require('../utils');

const decoderBlacklist = [ 'Filler', 'Style', 'levels' ];
const validExt = '.bin';
const validSides = [ 'B', 'C' ];

class Side {
	/**
	 * Creates a Side instance
	 * @constructor
	 * @param {Object} [opts={}] - Optional object that contains properties for the constructor
	 * @example
	 * // returns a Side
	 * const { Side } = require('lucid-dream');
	 * const side = new Side();
	 * @property {Map} map - The map for this side
	 * @property {Object} data - The metadata for the side
	 * @property {String} sideName - The name of this side, either `A`, `B`, or `C`
	 */
	constructor(data = {}) {
		Object.assign(this, {
			map: new Map(),
			data: {},
			sideName: 'A'
		}, data);
	}

	/**
	 * Load the map data and metadata for a side from a `.bin` file
	 * @param {String} file - The path to the `.bin` file to load
	 * @example
	 * const { Side } = require('lucid-dream');
	 * const side = new Side();
	 * await side.load('/path/to/my-map.bin');
	 * @returns {null}
	 */
	async decode(file) {

		// ensure we received a proper file argument
		if (!file) {
			throw new Error('must provide a map file');
		}
		if (typeof file !== 'string') {
			throw new Error('map file argument must be a string');
		}

		// make sure file is an actual bin file
		const filename = path.basename(file);
		if (path.extname(file) !== validExt) {
			throw new Error(`invalid side file "${filename}", must have a .bin extension"`);
		}
		const basename = path.basename(file, validExt);
		const sideName = basename.split('-').pop();
		this.sideName = validSides.includes(sideName) ? sideName : 'A';

		// decode map data
		const mapData = await this.map.decode(file);
		this.data = loadMetadata.bind(this)(mapData);
	}

	/**
	 * Encodes a side to a file
	 * @param {String} file - The file to which to write the encoded side
	 * @example
	 * const { Side } = require('lucid-dream');
	 * const side = new Side();
	 * await side.load('/path/to/my-map.bin');
	 * // make changes to side/map/meta data
	 * await side.encode('/path/to/my-new-map.bin');
	 */
	async encode(file) {
		const data = this.map;
		encodeMetadata.bind(this)(data);
		await this.map.encode(data, file);
	}

}


/*********************/
/* private functions */
/*********************/

function loadMetadata(data) {
	const res = {};
	for (let child of children(data)) {
		if (!decoderBlacklist.includes(child.__name)) {
			loadDataAsDict(res, child);
		}
	}
	return res;
}

function encodeMetadata(target) {
	for (let [ key, value ] of Object.entries(this.data)) {
		target.__children.push(dictAsEncodedData(key, value));
	}
}

module.exports = Side;
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Thu May 14 2020 14:54:40 GMT-0400 (Eastern Daylight Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>


<script src="scripts/collapse.js" defer></script>


</body>
</html>
